# MediOrder 项目分析报告

## 项目概览

MediOrder 是一个专为医院场景设计的便捷订餐系统，旨在为患者和医院用户提供简单、快速的订餐体验。

### 核心功能
1. **二维码扫码下单**：通过扫描床头二维码自动填写配送信息
2. **餐馆浏览**：展示附近合作餐馆及其菜单
3. **支付系统**：通过商家提供的二维码支付，并生成订单验证码
4. **订单跟踪**：实时查看订单状态

## 技术架构

### 前端技术栈
- **框架**：Next.js 15
- **语言**：TypeScript
- **样式**：Tailwind CSS
- **UI组件**：Radix UI
- **图标库**：Lucide React
- **状态管理**：React Context API
- **表单处理**：React Hook Form
- **数据获取**：TanStack Query (React Query)

### 后端服务
- **当前**：Firebase (Firestore, Authentication, Storage)
- **计划迁移**：自托管 Supabase (PostgreSQL, Auth, Storage)

### 开发工具
- **AI集成**：Genkit (Google AI)
- **包管理**：npm
- **开发环境**：Node.js

## 目录结构

```
src/
├── app/                 # 页面路由
│   ├── admin/          # 管理员功能模块
│   ├── merchant/       # 商户功能模块
│   ├── scan/           # 二维码扫描功能
│   ├── restaurants/    # 餐馆浏览功能
│   ├── checkout/       # 结账支付流程
│   ├── orders/         # 订单管理
│   ├── cart/           # 购物车功能
│   └── ...
├── components/         # 可复用UI组件
│   ├── ui/             # 基础UI组件 (来自shadcn/ui)
│   ├── layout/         # 布局组件
│   └── ...
├── contexts/           # React Context状态管理
├── lib/                # 工具库和配置文件
├── hooks/              # 自定义React Hooks
└── types/              # TypeScript类型定义
```

## 用户角色与权限

### 1. 普通用户 (患者/访客)
**功能权限**：
- 浏览附近餐馆和菜单
- 添加商品到购物车
- 扫描二维码或手动输入配送信息
- 下单并选择支付方式
- 查看和跟踪订单状态
- 管理收藏夹

### 2. 商户 (餐馆)
**功能权限**：
- 管理餐馆信息和设置
- 管理菜单项（添加、编辑、上下架）
- 查看和处理订单
- 设置促销活动
- 查看经营分析（计划中）

### 3. 管理员
**功能权限**：
- 管理床位二维码
- 审核和管理商户
- 系统设置（计划中）

## 核心业务流程

### 1. 二维码扫描流程
1. 用户访问扫描页面
2. 扫描床位二维码（或手动输入二维码数据）
3. 系统解析二维码中的配送信息（床位ID、部门、房间等）
4. 信息存储在本地存储中，用于后续下单流程

### 2. 订餐流程
1. 用户浏览餐馆列表
2. 选择餐馆并查看菜单
3. 将菜品添加到购物车
4. 进入购物车页面确认订单
5. 跳转到结账页面

### 3. 支付流程
1. 在结账页面确认配送信息
2. 选择支付方式（二维码支付或现金支付）
3. 如果选择二维码支付：
   - 系统显示商家收款二维码
   - 用户使用支付应用扫描并付款
   - 复制订单金额和验证码到支付备注
4. 确认订单并提交
5. 系统创建订单并更新状态

### 4. 订单管理流程
1. 用户可以在个人订单页面查看所有历史订单
2. 商户在商户后台查看和处理其餐馆的订单
3. 订单状态包括：待支付、已下单、准备中、配送中、已完成、已取消

## 数据模型

### 餐馆 (Restaurant)
- ID
- 名称
- 菜系
- 距离
- 评分
- 配送时间
- 支付方式
- 促销活动

### 菜单项 (MenuItem)
- ID
- 名称
- 描述
- 价格
- 图片URL
- 所属餐馆ID
- 可用性状态

### 订单 (Order)
- ID
- 商品列表
- 总金额
- 状态
- 下单时间
- 配送地址
- 验证码
- 餐馆信息
- 客户信息
- 支付二维码URL

### 用户 (User)
- UID (Firebase Auth ID)
- 邮箱
- 角色 (普通用户/商户/管理员)

## 当前开发状态

### 已实现功能
- 用户认证系统
- 餐馆和菜单浏览
- 购物车功能
- 二维码扫描模拟
- 订单管理和跟踪
- 商户后台管理
- 管理员后台

### 待完善功能
- 实际的二维码扫描功能
- 商户经营分析
- 系统设置模块
- 用户评价系统

### 迁移计划
项目计划从Firebase迁移到自托管的Supabase服务，以获得更好的数据一致性和查询能力。